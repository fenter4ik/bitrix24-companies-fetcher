# Как получить вебхук Bitrix24

## Способ 1: Через раздел "Разработчикам" (Рекомендуется)

### Шаг 1: Вход в портал
1. Откройте ваш портал Bitrix24: `https://ваш-портал.bitrix24.ru`
2. Войдите в систему

### Шаг 2: Переход в раздел разработчиков
1. В левом меню найдите иконку **"Приложения"** (Apps) или **"Маркетплейс"**
2. Или перейдите напрямую: `https://ваш-портал.bitrix24.ru/marketplace/`
3. В верхнем меню выберите **"Разработчикам"** или **"Developers"**

### Шаг 3: Создание входящего вебхука
1. Найдите раздел **"Входящий вебхук"** (Incoming Webhook)
2. Нажмите кнопку **"Добавить"** или **"Создать"**
3. Введите название (например: "Получение компаний CRM")

### Шаг 4: Настройка прав доступа
Обязательно выберите следующие права:
- ✅ **CRM** - полный доступ (или хотя бы чтение)
- ✅ **Пользователи** - для получения информации о пользователях (опционально)

**Важно**: Для получения списка компаний необходим доступ к CRM!

### Шаг 5: Копирование вебхука
1. После создания вебхука вы увидите его URL
2. Формат: `https://ваш-портал.bitrix24.ru/rest/1/xxxxxxxxxxxxxxxxxxxx/`
3. **Скопируйте весь URL полностью**, включая слэш `/` в конце

---

## Способ 2: Через настройки CRM

1. Перейдите в **CRM**
2. Откройте **Настройки** → **Другие настройки**
3. Найдите раздел **"REST API"** или **"Вебхуки"**
4. Создайте новый **входящий вебхук**
5. Настройте права доступа к CRM
6. Скопируйте URL вебхука

---

## Проверка вебхука

Вы можете проверить, что вебхук работает правильно:

1. Откройте URL вебхука в браузере
2. Должна появиться информация о доступных методах API
3. Если видите JSON с методами - вебхук работает!

Пример проверки:
```
https://ваш-портал.bitrix24.ru/rest/1/ваш-код/
```

---

## Пример вебхука

Вебхук выглядит примерно так:
```
https://mycompany.bitrix24.ru/rest/1/abc123def456ghi789jkl012/
```

**Важно:**
- URL должен начинаться с `https://`
- Должен содержать `/rest/1/`
- Должен заканчиваться на `/` (слэш)
- Код после `/rest/1/` - это уникальный идентификатор вашего вебхука

---

## Безопасность

⚠️ **ВНИМАНИЕ**: Вебхук дает доступ к данным вашего Bitrix24!

- Не публикуйте вебхук в открытых репозиториях
- Не передавайте вебхук третьим лицам
- Если вебхук был скомпрометирован - удалите его и создайте новый
- Используйте минимально необходимые права доступа

---

## Использование вебхука в приложении

После получения вебхука вы можете использовать его тремя способами:

### 1. Через веб-интерфейс
- Запустите приложение: `npm start`
- Откройте `http://localhost:3000`
- Вставьте вебхук в поле ввода
- Нажмите "Получить компании"

### 2. Через переменную окружения
```bash
# Windows PowerShell
$env:BITRIX24_WEBHOOK="https://ваш-портал.bitrix24.ru/rest/1/код/"

# Windows CMD
set BITRIX24_WEBHOOK=https://ваш-портал.bitrix24.ru/rest/1/код/

# Linux/Mac
export BITRIX24_WEBHOOK="https://ваш-портал.bitrix24.ru/rest/1/код/"
```

### 3. Через API запрос
```bash
curl -X POST http://localhost:3000/api/fetch-companies \
  -H "Content-Type: application/json" \
  -d '{"webhook": "https://ваш-портал.bitrix24.ru/rest/1/код/"}'
```

---

## Решение проблем

### Ошибка: "Вебхук не указан"
- Убедитесь, что вы скопировали весь URL вебхука
- Проверьте, что URL заканчивается на `/`

### Ошибка: "Bitrix24 API ошибка: Access denied"
- Проверьте права доступа вебхука
- Убедитесь, что вебхук имеет доступ к CRM

### Ошибка: "Invalid webhook"
- Проверьте правильность URL
- Убедитесь, что вебхук не был удален
- Создайте новый вебхук, если старый не работает

### Нет данных
- Проверьте, что в вашем Bitrix24 есть компании
- Убедитесь, что вебхук имеет права на чтение компаний

