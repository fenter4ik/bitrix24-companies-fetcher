# Bitrix24 Companies Fetcher

Приложение для получения списка компаний из Bitrix24 через REST API с использованием вебхука.

## Описание

Приложение получает до 10,000 компаний из Bitrix24 через REST API, используя пагинацию для обработки больших объемов данных. Результаты отображаются в удобном веб-интерфейсе.

## Технологии

- **Backend**: Node.js + Express
- **Frontend**: Vue.js 3
- **HTTP клиент**: Axios

## Установка

1. Клонируйте репозиторий или скачайте код
2. Установите зависимости:

```bash
npm install
```

## Использование

### Способ 1: Через веб-интерфейс

1. Запустите сервер:

```bash
npm start
```

2. Откройте браузер и перейдите по адресу: `http://localhost:3000`
3. Введите ваш вебхук Bitrix24 в поле ввода
4. Нажмите кнопку "Получить компании"
5. Дождитесь загрузки данных (может занять некоторое время для 10,000 записей)

### Способ 2: Через переменную окружения

1. Установите переменную окружения с вебхуком:

**Windows (PowerShell):**
```powershell
$env:BITRIX24_WEBHOOK="https://ваш-портал.bitrix24.ru/rest/1/ваш-код/"
npm start
```

**Windows (CMD):**
```cmd
set BITRIX24_WEBHOOK=https://ваш-портал.bitrix24.ru/rest/1/ваш-код/
npm start
```

**Linux/Mac:**
```bash
export BITRIX24_WEBHOOK="https://ваш-портал.bitrix24.ru/rest/1/ваш-код/"
npm start
```

2. Откройте браузер: `http://localhost:3000`
3. Нажмите "Получить компании" (вебхук будет использован из переменной окружения)

### Способ 3: Через API напрямую

```bash
curl -X POST http://localhost:3000/api/fetch-companies \
  -H "Content-Type: application/json" \
  -d '{"webhook": "https://ваш-портал.bitrix24.ru/rest/1/ваш-код/"}'
```

## Получение вебхука Bitrix24

### Пошаговая инструкция:

1. **Войдите в ваш портал Bitrix24**
   - Откройте браузер и перейдите на ваш портал: `https://ваш-портал.bitrix24.ru`

2. **Перейдите в раздел настроек приложений**
   - В левом меню найдите иконку **"Приложения"** (или "Apps")
   - Или перейдите напрямую по ссылке: `https://ваш-портал.bitrix24.ru/marketplace/`
   - В верхнем меню выберите **"Разработчикам"** или **"Developers"**

3. **Создайте входящий вебхук**
   - Найдите раздел **"Входящий вебхук"** (Incoming Webhook)
   - Нажмите кнопку **"Добавить"** или **"Создать"**
   - Введите название вебхука (например: "Получение компаний")

4. **Настройте права доступа**
   - В разделе прав доступа обязательно выберите:
     - ✅ **CRM** (полный доступ или хотя бы чтение)
     - ✅ **Пользователи** (для получения информации о пользователях, если нужно)
   - Можно выбрать "Полный доступ" для упрощения

5. **Скопируйте URL вебхука**
   - После создания вебхука вы увидите его URL
   - Формат будет примерно таким: `https://ваш-портал.bitrix24.ru/rest/1/xxxxxxxxxxxxxxxxxxxx/`
   - **Важно**: Скопируйте весь URL полностью, включая слэш в конце

6. **Используйте вебхук в приложении**
   - Вставьте скопированный URL в поле "Вебхук Bitrix24" в веб-интерфейсе
   - Или используйте его в переменной окружения `BITRIX24_WEBHOOK`

### Альтернативный способ (через настройки CRM):

1. Перейдите в **CRM → Настройки → Другие настройки**
2. Найдите раздел **"REST API"** или **"Вебхуки"**
3. Создайте новый входящий вебхук с правами доступа к CRM

### Важные замечания:

- ⚠️ **Безопасность**: Вебхук дает полный доступ к данным согласно выбранным правам. Храните его в секрете!
- ⚠️ **Формат URL**: URL должен заканчиваться на `/` (слэш)
- ⚠️ **Права доступа**: Убедитесь, что вебхук имеет права на чтение компаний (CRM)
- ✅ **Проверка**: Вы можете проверить вебхук, открыв его в браузере - должна появиться информация о методах API

## Особенности

- **Пагинация**: Автоматическая обработка пагинации (Bitrix24 возвращает максимум 50 записей за раз)
- **Обработка ошибок**: Детальные сообщения об ошибках
- **Красивый UI**: Современный интерфейс с таблицей компаний
- **Производительность**: Оптимизированная загрузка данных с задержками между запросами

## Структура проекта

```
.
├── server.js          # Express сервер с API endpoints
├── package.json       # Зависимости проекта
├── public/
│   └── index.html    # Vue.js фронтенд
├── .gitignore
└── README.md
```

## API Endpoints

- `GET /` - Главная страница с интерфейсом
- `POST /api/fetch-companies` - Получение списка компаний
  - Body: `{ "webhook": "https://..." }`
  - Response: `{ "success": true, "count": 10000, "companies": [...] }`
- `GET /api/status` - Проверка статуса сервера

## Порт

По умолчанию приложение запускается на порту 3000. Для изменения используйте переменную окружения:

```bash
PORT=8080 npm start
```

## Требования

- Node.js 14.x или выше
- npm или yarn

## Лицензия

ISC

